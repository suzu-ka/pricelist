<link rel="stylesheet" type="text/css" href="stylesheets/sp_show.scss">

<div class="sp_show_link">
  <% if user_signed_in? %>
   <%= link_to "マイページ", user_path(current_user.id) %>
  <% end %>
  <%= link_to "投稿一覧", items_path %>
  <%= link_to 'Food一覧', {:controller => "items", :action => "food"}, method: :post %>
  <%= link_to 'Life一覧', {:controller => "items", :action => "life"}, method: :post %>
  <%= link_to 'Fashion一覧', {:controller => "items", :action => "fashion"}, method: :post %>
  <%= link_to 'Toy一覧', {:controller => "items", :action => "toy"}, method: :post %>
  <%= link_to 'Character一覧', {:controller => "items", :action => "character"}, method: :post %>
  <%= link_to 'Others一覧', {:controller => "items", :action => "others"}, method: :post %>
</div>

<div class="sp_show">
  <h3>投稿詳細</h3>
  <div class="sp_show_items">
    <div class="sp_show_info">
      <div id="sp_show_name">
        <p><%= @item.name %></p>
      </div>
      <div id="sp_basic_info">
        <%= @item.price %>円<br>
        <%= simple_format(@item.about) %>
      </div><br>

      <div id="sp_other_info">
        <!-- いいね -->
        <div class="sp_like">
          <% if user_signed_in? %>      
            <% if current_user.already_liked?(@item) %>
              <%= link_to item_like_path(@item), method: :delete do %>
               <i class="fas fa-heart sp_color"></i>&thinsp;<%= @item.likes.count %>
              <% end %>
            <% else %>
              <%= link_to item_likes_path(@item), method: :post do %>
               <i class="far fa-heart sp_color"></i>&thinsp;<%= @item.likes.count %>
              <% end %>
            <% end %>
          <% else %>
           <i class="far fa-heart sp_color"></i>&thinsp;<%= @item.likes.count %>
          <% end %>&ensp;
        </div>
  
        <div id="sp_date_info">
          <%= @item.created_at %>
        </div>
      </div>
    </div>

    <div class="sp_show_image">
      <%= image_tag @item.image_url, size: "250x300" if @item.image? %>
    </div>

    <div class="sp_show_like">
      <h4>いいねしたユーザー</h4>
      <div class="sp_show_like_user">
        <% @item.liked_users.each do |user| %>
          <li><a href="/users/<%= user.id %>"><%= user.user_name %></a></li>
        <% end %>
      </div>
    </div>

    <!-- コメント -->
    <div class="sp_comment">
      <div class="sp_show_comment_all">
        <h4>コメント一覧</h4>
        <div class="sp_show_comments">
          <% @comments.each do |c| %>
            <li><a href="/users/<%= c.user.id %>"><%= c.user.user_name %></a>&ensp;
            <% if user_signed_in? && current_user.id == c.user_id %>
              <%= link_to item_comment_path(@item), data: { confirm: "本当によろしいですか？" }, method: :delete do %>
                <i class="far fa-trash-alt sp_comment_color"></i>
              <% end %>
            <% end %>
            <%= simple_format(c.content) %><br></li>
          <% end %>
        </div>
      </div>

      <div class="sp_show_comment">
        <%= form_with(model: [@item, @comment], local: true) do |f| %>
          <%= f.text_area :content, :size => "50×30", :id => "comment_content" %>
          <% if user_signed_in? %>
            <button type="button" onclick="submit();" id="sp_comment_button">コメントする</button>
          <% end %>
        <% end %>
      </div>
    </div>
  </div>
</div>